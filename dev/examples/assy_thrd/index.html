<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Assembly Line · DiscreteEventsCompanion.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">DiscreteEventsCompanion.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../DES/">Discrete Event Systems</a></li><li><a class="tocitem" href="../../clocks/">Clocks</a></li><li><a class="tocitem" href="../../actions/">Actions</a></li><li><a class="tocitem" href="../../sampling/">Sampling</a></li><li><a class="tocitem" href="../../events/">Events</a></li><li><a class="tocitem" href="../../activities/">Activities</a></li><li><a class="tocitem" href="../../processes/">Processes</a></li><li><a class="tocitem" href="../../random/">Randomness</a></li><li><a class="tocitem" href="../../automata/">State Machines</a></li><li><a class="tocitem" href="../../actors/">Actors</a></li><li><a class="tocitem" href="../../models/">Models</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../examples/">Overview</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Introductory</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../singleserver/">Single Server</a></li><li><a class="tocitem" href="../tabletennis/">Table Tennis</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">M/M/c Queue</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../queue_mmc_act/">M/M/c Activities</a></li><li><a class="tocitem" href="../queue_mmc_srv/">M/M/c Processes</a></li><li><a class="tocitem" href="../queue_mmc_sm/">M/M/c State Machines</a></li><li><a class="tocitem" href="../queue_mmc_actor/">M/M/c Actors</a></li><li><a class="tocitem" href="../queue_mmc_srv_fail/">M/M/c Interrupted Processes</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox" checked/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Multi-Threading (Experimental)</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Assembly Line</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Other</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../house_heating/house_heating/">House Heating</a></li><li><a class="tocitem" href="../postoffice/postoffice/">Post Office</a></li><li><a class="tocitem" href="../dicegame/dicegame/">Goldratt&#39;s Dice Game</a></li></ul></li></ul></li><li><a class="tocitem" href="../../performance/">Performance</a></li><li><a class="tocitem" href="../../parallel/">Parallel Simulation</a></li><li><a class="tocitem" href="../../benchmarks/">Benchmarks</a></li><li><a class="tocitem" href="../../diag/">Diagnosis</a></li><li><a class="tocitem" href="../../internals/">Internals</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li><a class="is-disabled">Multi-Threading (Experimental)</a></li><li class="is-active"><a href>Assembly Line</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Assembly Line</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/pbayer/DiscreteEventsCompanion.jl/blob/master/docs/src/examples/assy_thrd.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Multi-Threaded-Assembly"><a class="docs-heading-anchor" href="#Multi-Threaded-Assembly">Multi-Threaded Assembly</a><a id="Multi-Threaded-Assembly-1"></a><a class="docs-heading-anchor-permalink" href="#Multi-Threaded-Assembly" title="Permalink"></a></h1><p>An assembly line in a car or engine plant consists of several sections, which are decoupled by intermediary buffers for some cars or engines. Inside a section workers or work stations are more strongly coupled with buffers of one or two items in between. Usually those assembly lines are quite long with dozens or even hundreds of work stations.</p><p>This is an ideal scenario for a multithreaded simulation where we can simulate the sections on different threads, connected by channels of some capacity for decoupling. We assume that assembly operations have a normal distribution <span>$\mathcal{N}(\mu,\sigma^2)\;|\; \mu=1.0,\sigma=0.1$</span> constraining line throughput.</p><p>We will define an <code>assy</code> operation as a simple sequential process, an <code>assyLine</code> setting up <span>$N$</span> such operations with <span>$\textrm{buf}$</span> buffers between each two sequential work stations on a thread-local clock with thread id <span>$\textrm{thrd}$</span> it will run on. The arrival process is as usual.</p><pre><code class="language-julia">using DiscreteEvents, Distributions, Random, Printf, .Threads

# describe an assembly process
function assy(c::Clock, input::Channel, output::Channel, S::Distribution, id::Int)
    job = take!(input)
    delay!(c, S)
    put!(output, job)
end

# setup an assembly line of N nodes between input and output
# buf is the buffer size between the nodes
function assyLine(c::Clock, input::Channel, output::Channel, 
                  S::Distribution, N::Int, buf::Int; thrd=1)
    inp = input
    out = N &gt; 1 ? typeof(input)(buf) : output
    for i in 1:N
        process!(c, Prc(i, assy, inp, out, S, i), cid=thrd)
        inp = out
        out = i &lt; (N-1) ? typeof(input)(buf) : output
    end
end

# arrivals
function arrive(c::Clock, input::Channel, jobno::Vector{Int}, A::Distribution)
    jobno[1] += 1
    delay!(c, A)
    put!(input, jobno[1])
end</code></pre><p>We seed the default random number generators on each thread with <code>pseed</code>, setup a <code>PClock</code> with parallel clocks, create input and output buffers for the entire line and the buffers between the sections. For simplicity we take the number of threads <code>nthreads()</code> of our local machine as the number of sections of our assembly line. We setup an <code>assyLine</code> section on each thread connected by buffers. Then we start the <code>arrive</code> process on the master clock of thread 1.</p><pre><code class="language-julia">pseed!(123)
const M₁ = Exponential(1/0.9)
const M₂ = Normal(1, 0.1)
const jobno = [4]

clk = PClock(0.1)
input = Channel{Int}(10)
buffer = [Channel{Int}(10) for _ in 2:nthreads()]
output = Channel{Int}(Inf)
foreach(i-&gt;put!(input, i), 1:3)
for i in 1:nthreads()
    inp = i == 1 ? input : buffer[i-1]
    out = i &lt; nthreads() ? buffer[i] : output
    assyLine(clk, inp, out, M₂, 10, 2, thrd=i)
end
process!(clk, Prc(0, arrive, input, jobno, M₁))</code></pre><p>If we run the simulation, we get the following output:</p><pre><code class="language-julia">julia&gt; @time run!(clk, 1000)
  1.582942 seconds (5.72 M allocations: 284.722 MiB, 2.65% gc time)
&quot;run! finished with 63452 clock events, 10000 sample steps, simulation time: 1000.0&quot;

julia&gt; length(output)
748</code></pre><p>It took 1.6 seconds for an assembly line with 8 sections of each 10 workstations to simulate a throughput of 748 cars/engines.</p><p>Below I give the platform information:</p><pre><code class="language-julia">julia&gt; versioninfo()
Julia Version 1.5.1
Commit 697e782ab8 (2020-08-25 20:08 UTC)
Platform Info:
  OS: macOS (x86_64-apple-darwin19.5.0)
  CPU: Intel(R) Core(TM) i9-9880H CPU @ 2.30GHz
  WORD_SIZE: 64
  LIBM: libopenlibm
  LLVM: libLLVM-9.0.1 (ORCJIT, skylake)
Environment:
  JULIA_NUM_THREADS = 8
  JULIA_EDITOR = &quot;/Applications/Visual Studio Code.app/Contents/Resources/app/bin/code&quot;</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../queue_mmc_srv_fail/">« M/M/c Interrupted Processes</a><a class="docs-footer-nextpage" href="../house_heating/house_heating/">House Heating »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 11 September 2020 20:25">Friday 11 September 2020</span>. Using Julia version 1.5.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
