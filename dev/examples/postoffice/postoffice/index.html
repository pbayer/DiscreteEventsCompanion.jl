<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Post Office ¬∑ DiscreteEventsCompanion.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">DiscreteEventsCompanion.jl</span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../DES/">Overview</a></li><li><a class="tocitem" href="../../../clocks/">Clocks</a></li><li><a class="tocitem" href="../../../actions/">Actions</a></li><li><a class="tocitem" href="../../../sampling/">Sampling</a></li><li><a class="tocitem" href="../../../events/">Events</a></li><li><a class="tocitem" href="../../../activities/">Activities</a></li><li><a class="tocitem" href="../../../processes/">Processes</a></li><li><a class="tocitem" href="../../../random/">Randomness</a></li><li><a class="tocitem" href="../../../automata/">State Machines</a></li><li><a class="tocitem" href="../../../actors/">Actors</a></li><li><a class="tocitem" href="../../../models/">Models</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/">Overview</a></li><li><a class="tocitem" href="../../singleserver/">Single Server</a></li><li><a class="tocitem" href="../../tabletennis/">Table Tennis</a></li><li><a class="tocitem" href="../../queue_mmc_act/">M/M/c Activities</a></li><li><a class="tocitem" href="../../queue_mmc_srv/">M/M/c Processes</a></li><li><a class="tocitem" href="../../queue_mmc_sm/">M/M/c State Machines</a></li><li><a class="tocitem" href="../../queue_mmc_actor/">M/M/c Actors</a></li><li><a class="tocitem" href="../../house_heating/house_heating/">House Heating</a></li><li class="is-active"><a class="tocitem" href>Post Office</a><ul class="internal"><li><a class="tocitem" href="#Conclusion"><span>Conclusion</span></a></li></ul></li><li><a class="tocitem" href="../../dicegame/dicegame/">Goldratt&#39;s Dice Game</a></li></ul></li><li><a class="tocitem" href="../../../performance/">Performance</a></li><li><a class="tocitem" href="../../../parallel/">Parallel Simulation</a></li><li><a class="tocitem" href="../../../benchmarks/">Benchmarks</a></li><li><a class="tocitem" href="../../../diag/">Diagnosis</a></li><li><a class="tocitem" href="../../../internals/">Internals</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Post Office</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Post Office</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/pbayer/DiscreteEventsCompanion.jl/blob/master/docs/src/examples/postoffice/postoffice.md" title="Edit on GitHub"><span class="docs-icon fab">ÔÇõ</span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Post-Office"><a class="docs-heading-anchor" href="#Post-Office">Post Office</a><a id="Post-Office-1"></a><a class="docs-heading-anchor-permalink" href="#Post-Office" title="Permalink"></a></h1><p>There is a small post office with one clerk serving the arriving customers. Customers have differing wishes leading to different serving times, from 1 - 5 minutes. We have a little variation in serving times due to variation in customer habits and clerk performance. The arrival rate of customers is about 18 per hour, every 3.33 minutes or 3 minutes, 20 seconds on average. Our post office is small and customer patience is limited, so queue length is limited to 5 customers.</p><p>We have provided 10% extra capacity, so our expectation is that there should not be too many customers discouraged for long waiting times or for full queues.</p><p><img src="../PostOffice.png" alt="post office"/></p><p>Let&#39;s do a process-based simulation using <code>DiscreteEvents</code>. We need</p><ol><li>a source: all the <strong>people</strong>, providing an unlimited supply for customers,</li><li><strong>customers</strong> with their demands and their limited patience,</li><li>a <strong>queue</strong> and</li><li>our good old <strong>clerk</strong>.</li></ol><p>First we must load the needed modules, describe a customer and define some helper functions:</p><pre><code class="language-julia">using DiscreteEvents, Random, Distributions, DataFrames

mutable struct Customer
    id::Int64
    arrival::Float64
    request::Int64

    Customer(n::Int64, arrival::Float64) = new(n, arrival, rand(DiscreteUniform(1, 5)))
end

full(q::Channel) = length(q.data) &gt;= q.sz_max
logevent(nr, queue::Channel, info::AbstractString, wt::Number) =
    push!(df, (round(œÑ(), digits=2), nr, length(queue.data), info, wt))</code></pre><p>logevent (generic function with 1 method)</p><p>Then we define functions for our processes: people and clerk.</p><pre><code class="language-julia">function people(output::Channel, Œ≤::Float64)
    i = 1
    while true
        Œît = rand(Exponential(Œ≤))
        delay!(Œît)
        if !full(output)
            put!(output, Customer(i, œÑ()))
            logevent(i, output, &quot;enqueues&quot;, 0)
         else
            logevent(i, output, &quot;leaves - queue is full!&quot;, -1)
        end
        i += 1
    end
end

function clerk(input::Channel)
    cust = take!(input)
    Œît = cust.request + randn()*0.2
    logevent(cust.id, input, &quot;now being served&quot;, œÑ() - cust.arrival)
    delay!(Œît)
    logevent(cust.id, input, &quot;leaves&quot;, œÑ() - cust.arrival)
end</code></pre><p>clerk (generic function with 1 method)</p><p>Then we have to create a logging table, register and startup the processes:</p><pre><code class="language-julia">reset!(ùê∂)  # for repeated runs it is easier if we reset our central clock here
Random.seed!(2019)  # seed random number generator for reproducibility
queue = Channel(5)  # thus we determine the max size of the queue

df = DataFrame(time=Float64[], cust=Int[], qlen=Int64[], status=String[], wtime=Float64[])

process!(ùê∂, SimProcess(1, people, queue, 3.333)) # register the functions as processes
process!(ùê∂, SimProcess(2, clerk, queue))</code></pre><p>2</p><p>Then we can simply run the simulation. We assume our time unit being minutes, so we run for 600 units:</p><pre><code class="language-julia">println(run!(ùê∂, 600))
println(&quot;``(length(queue.data)) customers yet in queue&quot;)</code></pre><p>run! finished with 338 clock events, 0 sample steps, simulation time: 600.0<br/>0 customers yet in queue</p><p>Our table has registered it all:</p><pre><code class="language-julia">df</code></pre><table><tr><th style="text-align: right">no</th><th style="text-align: right">time</th><th style="text-align: right">cust</th><th style="text-align: right">qlen</th><th style="text-align: right">status</th><th style="text-align: right">wtime</th></tr><tr><td style="text-align: right">1</td><td style="text-align: right">1.2</td><td style="text-align: right">1</td><td style="text-align: right">1</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">2</td><td style="text-align: right">1.2</td><td style="text-align: right">1</td><td style="text-align: right">0</td><td style="text-align: right">now being served</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">3</td><td style="text-align: right">5.46</td><td style="text-align: right">2</td><td style="text-align: right">1</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">4</td><td style="text-align: right">5.5</td><td style="text-align: right">3</td><td style="text-align: right">2</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">5</td><td style="text-align: right">6.19</td><td style="text-align: right">1</td><td style="text-align: right">2</td><td style="text-align: right">leaves</td><td style="text-align: right">4.99532</td></tr><tr><td style="text-align: right">6</td><td style="text-align: right">6.19</td><td style="text-align: right">2</td><td style="text-align: right">1</td><td style="text-align: right">now being served</td><td style="text-align: right">0.737497</td></tr><tr><td style="text-align: right">7</td><td style="text-align: right">7.99</td><td style="text-align: right">4</td><td style="text-align: right">2</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">8</td><td style="text-align: right">8.81</td><td style="text-align: right">2</td><td style="text-align: right">2</td><td style="text-align: right">leaves</td><td style="text-align: right">3.35581</td></tr><tr><td style="text-align: right">9</td><td style="text-align: right">8.81</td><td style="text-align: right">3</td><td style="text-align: right">1</td><td style="text-align: right">now being served</td><td style="text-align: right">3.30971</td></tr><tr><td style="text-align: right">10</td><td style="text-align: right">12.33</td><td style="text-align: right">5</td><td style="text-align: right">2</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">11</td><td style="text-align: right">12.98</td><td style="text-align: right">3</td><td style="text-align: right">2</td><td style="text-align: right">leaves</td><td style="text-align: right">7.4733</td></tr><tr><td style="text-align: right">12</td><td style="text-align: right">12.98</td><td style="text-align: right">4</td><td style="text-align: right">1</td><td style="text-align: right">now being served</td><td style="text-align: right">4.98585</td></tr><tr><td style="text-align: right">13</td><td style="text-align: right">13.73</td><td style="text-align: right">4</td><td style="text-align: right">1</td><td style="text-align: right">leaves</td><td style="text-align: right">5.74268</td></tr><tr><td style="text-align: right">14</td><td style="text-align: right">13.73</td><td style="text-align: right">5</td><td style="text-align: right">0</td><td style="text-align: right">now being served</td><td style="text-align: right">1.39837</td></tr><tr><td style="text-align: right">15</td><td style="text-align: right">15.72</td><td style="text-align: right">6</td><td style="text-align: right">1</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">16</td><td style="text-align: right">17.12</td><td style="text-align: right">7</td><td style="text-align: right">2</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">17</td><td style="text-align: right">17.73</td><td style="text-align: right">5</td><td style="text-align: right">2</td><td style="text-align: right">leaves</td><td style="text-align: right">5.3967</td></tr><tr><td style="text-align: right">18</td><td style="text-align: right">17.73</td><td style="text-align: right">6</td><td style="text-align: right">1</td><td style="text-align: right">now being served</td><td style="text-align: right">2.00988</td></tr><tr><td style="text-align: right">19</td><td style="text-align: right">20.0</td><td style="text-align: right">8</td><td style="text-align: right">2</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">20</td><td style="text-align: right">20.76</td><td style="text-align: right">9</td><td style="text-align: right">3</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">21</td><td style="text-align: right">23.26</td><td style="text-align: right">6</td><td style="text-align: right">3</td><td style="text-align: right">leaves</td><td style="text-align: right">7.53774</td></tr><tr><td style="text-align: right">22</td><td style="text-align: right">23.26</td><td style="text-align: right">7</td><td style="text-align: right">2</td><td style="text-align: right">now being served</td><td style="text-align: right">6.13554</td></tr><tr><td style="text-align: right">23</td><td style="text-align: right">25.43</td><td style="text-align: right">10</td><td style="text-align: right">3</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">24</td><td style="text-align: right">26.0</td><td style="text-align: right">11</td><td style="text-align: right">4</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">25</td><td style="text-align: right">26.35</td><td style="text-align: right">7</td><td style="text-align: right">4</td><td style="text-align: right">leaves</td><td style="text-align: right">9.22525</td></tr><tr><td style="text-align: right">26</td><td style="text-align: right">26.35</td><td style="text-align: right">8</td><td style="text-align: right">3</td><td style="text-align: right">now being served</td><td style="text-align: right">6.34474</td></tr><tr><td style="text-align: right">27</td><td style="text-align: right">27.49</td><td style="text-align: right">12</td><td style="text-align: right">4</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">28</td><td style="text-align: right">27.64</td><td style="text-align: right">8</td><td style="text-align: right">4</td><td style="text-align: right">leaves</td><td style="text-align: right">7.63665</td></tr><tr><td style="text-align: right">29</td><td style="text-align: right">27.64</td><td style="text-align: right">9</td><td style="text-align: right">3</td><td style="text-align: right">now being served</td><td style="text-align: right">6.88549</td></tr><tr><td style="text-align: right">30</td><td style="text-align: right">29.06</td><td style="text-align: right">13</td><td style="text-align: right">4</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr></table><pre><code class="language-julia">last(df, 5)</code></pre><table><tr><th style="text-align: right">no</th><th style="text-align: right">time</th><th style="text-align: right">cust</th><th style="text-align: right">qlen</th><th style="text-align: right">status</th><th style="text-align: right">wtime</th></tr><tr><td style="text-align: right">1</td><td style="text-align: right">589.1</td><td style="text-align: right">171</td><td style="text-align: right">1</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">2</td><td style="text-align: right">589.1</td><td style="text-align: right">171</td><td style="text-align: right">0</td><td style="text-align: right">now being served</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">3</td><td style="text-align: right">593.77</td><td style="text-align: right">171</td><td style="text-align: right">0</td><td style="text-align: right">leaves</td><td style="text-align: right">4.67801</td></tr><tr><td style="text-align: right">4</td><td style="text-align: right">598.01</td><td style="text-align: right">172</td><td style="text-align: right">1</td><td style="text-align: right">enqueues</td><td style="text-align: right">0.0</td></tr><tr><td style="text-align: right">5</td><td style="text-align: right">598.01</td><td style="text-align: right">172</td><td style="text-align: right">0</td><td style="text-align: right">now being served</td><td style="text-align: right">0.0</td></tr></table><pre><code class="language-julia">describe(df[df[!, :wtime] .&gt; 0, :wtime])</code></pre><pre><code class="language-none">Summary Stats:
Length:         302
Missing Count:  0
Mean:           7.486712
Minimum:        0.009196
1st Quartile:   3.866847
Median:         6.409644
3rd Quartile:   10.541481
Maximum:        23.268310
Type:           Float64</code></pre><p>In <span>$600$</span> minutes simulation time, we registered <span>$172$</span> customers and <span>$505$</span> status changes. The mean and median waiting times were around <span>$7$</span> minutes.</p><pre><code class="language-julia">by(df, :status, df -&gt; size(df, 1))</code></pre><table><tr><th style="text-align: right">no</th><th style="text-align: right">status</th><th style="text-align: right">x1</th></tr><tr><td style="text-align: right">1</td><td style="text-align: right">enqueues</td><td style="text-align: right">167</td></tr><tr><td style="text-align: right">2</td><td style="text-align: right">now being served</td><td style="text-align: right">167</td></tr><tr><td style="text-align: right">3</td><td style="text-align: right">leaves</td><td style="text-align: right">166</td></tr><tr><td style="text-align: right">4</td><td style="text-align: right">leaves - queue is full!</td><td style="text-align: right">5</td></tr></table><p>Of the <span>$172$</span> customers, <span>$167$</span> of them participated in the whole process and were served, but <span>$5$</span> left beforehand because the queue was full:</p><pre><code class="language-julia">df[df.wtime .&lt; 0,:]</code></pre><table><tr><th style="text-align: right">no</th><th style="text-align: right">time</th><th style="text-align: right">cust</th><th style="text-align: right">qlen</th><th style="text-align: right">status</th><th style="text-align: right">wtime</th></tr><tr><td style="text-align: right">1</td><td style="text-align: right">45.32</td><td style="text-align: right">19</td><td style="text-align: right">5</td><td style="text-align: right">leaves - queue is full!</td><td style="text-align: right">-1.0</td></tr><tr><td style="text-align: right">2</td><td style="text-align: right">249.11</td><td style="text-align: right">66</td><td style="text-align: right">5</td><td style="text-align: right">leaves - queue is full!</td><td style="text-align: right">-1.0</td></tr><tr><td style="text-align: right">3</td><td style="text-align: right">270.04</td><td style="text-align: right">74</td><td style="text-align: right">5</td><td style="text-align: right">leaves - queue is full!</td><td style="text-align: right">-1.0</td></tr><tr><td style="text-align: right">4</td><td style="text-align: right">380.39</td><td style="text-align: right">106</td><td style="text-align: right">5</td><td style="text-align: right">leaves - queue is full!</td><td style="text-align: right">-1.0</td></tr><tr><td style="text-align: right">5</td><td style="text-align: right">382.02</td><td style="text-align: right">107</td><td style="text-align: right">5</td><td style="text-align: right">leaves - queue is full!</td><td style="text-align: right">-1.0</td></tr></table><pre><code class="language-julia">using PyPlot
step(df.time, df.wtime)
step(df.time, df.qlen)
axhline(y=0, color=&quot;k&quot;)
grid()
xlabel(&quot;time [min]&quot;)
ylabel(&quot;wait time [min], queue length&quot;)
title(&quot;Waiting Time in the Post Office&quot;)
legend([&quot;wait_time&quot;, &quot;queue_len&quot;]);</code></pre><p><img src="../output_17_0.png" alt="png"/></p><p>Many customers had waiting times of more than 10, 15 up to even more than 20 minutes. The negative waiting times were the 5 customers, which left because the queue was full.</p><p>So many customers will remain angry. If this is the situation all days, our post office will have an evil reputation. What should we do?</p><h2 id="Conclusion"><a class="docs-heading-anchor" href="#Conclusion">Conclusion</a><a id="Conclusion-1"></a><a class="docs-heading-anchor-permalink" href="#Conclusion" title="Permalink"></a></h2><p>Even if our process runs within predetermined bounds (queue length, customer wishes ‚Ä¶), it seems to fluctuate wildly and to produce unpredicted effects. This is due to variation in arrivals, in demands and in serving time on system performance. In this case 10% extra capacity is not enough to provide enough buffer for variation and for customer service ‚Äì even if our post clerk is the most willing person.</p><p>Even for such a simple everyday system, we cannot say beforehand ‚Äì without reality check ‚Äì which throughput, waiting times, mean queue length, capacity utilization or customer satisfaction will emerge. Even more so for more complicated systems in production, service, projects and supply chains with multiple dependencies.</p><p>If we had known the situation beforehand, we could have provided standby for our clerk or install an automatic stamp dispenser for cutting shorter tasks ‚Ä¶ We should have done a simulation before ‚Ä¶</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../house_heating/house_heating/">¬´ House Heating</a><a class="docs-footer-nextpage" href="../../dicegame/dicegame/">Goldratt&#39;s Dice Game ¬ª</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 28 August 2020 16:24">Friday 28 August 2020</span>. Using Julia version 1.5.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
